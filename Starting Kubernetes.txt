# Initialize cluster 
sudo kubeadm init --pod-network-cidr=10.244.0.0/16

# Startup flannel
kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml --validate=false

# For dev env
kubectl taint nodes --all node-role.kubernetes.io/control-plane-

# Create namespace
kubectl apply -f namespace.yaml

# Apply PostgreSQL deployment
kubectl apply -f postgres-deployment.yaml

# Apply Redis deployment
kubectl apply -f redis-deployment.yaml

# Apply connection pooling
kubectl apply -f pgbouncer-deployment.yaml

# Apply Ollama deployment
kubectl apply -f ollama-deployment.yaml

# Apply Autoscaling
kubectl apply -f autoscaling.yaml

# Verify deployments
kubectl get deployments -n app-infrastructure
kubectl get services -n app-infrastructure
kubectl get pods -n app-infrastructure

# Delete deployments
kubectl delete deployment postgres-deployment redis-deployment ollama-deployment pgbouncer-deployment -n app-infrastructure